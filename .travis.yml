---
language: python
python: "2.7"

before_install:
  - sudo apt-get update -qq

install:
  - pip install ansible yamllint pep8
  # Add ansible.cfg to pick up roles path.
  # - "printf '[defaults]\nroles_path = ../' > ansible.cfg"
script:
  # syntax check
  - yamllint ansible/raspi3.yaml
  - ansible-playbook  ansible/raspi3.yaml --syntax-check
  - bash -n install.sh
  - bash -n deploy.sh
  - bash -n run.sh
  - bash -n kill.sh
  - |
    find python/raspi_server -name '*.py' -exec \
    pep8 --ignore=E402 --show-source --max-line-length=100 {} +
  # ansible test
  - export SLACKBOT_API_TOKEN=dummy
  - ansible-playbook  -i localhost, ansible/raspi3.yaml --connection=local
  # test install.sh
  - ./install.sh
